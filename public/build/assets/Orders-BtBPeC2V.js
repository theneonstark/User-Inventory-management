import{a as E,r as l,j as e}from"./app-BQcaIY-e.js";import{L as ie}from"./Layout-DH3S-P2D.js";import{a as Q,I as f,B as d}from"./input-C3cybE54.js";import{T as de,a as ce,b as D,c,d as xe,e as i}from"./table-DyVqtby9.js";import{D as S,a as z,b as F,c as O,d as B,e as A}from"./dialog-_kpngBO7.js";import{y as g}from"./index-5-_raj7P.js";import{o as q}from"./orders-CfAbe6B9.js";import{I as x}from"./index-Cv23YCoD.js";import{C as oe}from"./circle-check-big-CZpyahZG.js";import{E as H}from"./eye-DUSbmVCT.js";import{f as me}from"./index-C4oF5NQb.js";import{p as ge}from"./index-f-02PV4C.js";import"./index-BO0joN0c.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ue=Q("CircleX",he);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],ye=Q("Clock",pe),je="https://imsuser.infinimorphconsulting.com/api/PayPendingPayment",fe={PendingPayment:async(N,h)=>E.post(je,{order_id:N,payment_amount:h})};E.create({baseURL:"https://imsuser.infinimorphconsulting.com/api",headers:{"Content-Type":"application/json"}});function Ne(){const[N,h]=l.useState([]),[u,G]=l.useState(""),[K,M]=l.useState(!0),[T,X]=l.useState(null),[a,b]=l.useState(null),[Y,p]=l.useState(!1),[J,y]=l.useState(!1),[V,k]=l.useState(!1),[o,L]=l.useState(""),[v,W]=l.useState(""),[w,Z]=l.useState(""),[C,ee]=l.useState("All"),[_,se]=l.useState([]);console.log(a);const ae="https://imsuser.infinimorphconsulting.com/api/expenses";l.useEffect(()=>{(async()=>{try{const r=(await q.getUserOrders()).orders.map(m=>({...m,products:typeof m.products=="string"?JSON.parse(m.products):m.products}));h(r||[]);const n=await E.get(ae);se(n.data.data||[])}catch(t){console.error("Error fetching data:",t),X("Failed to fetch data. Please try again later.")}finally{M(!1)}})()},[]);const te=s=>{const t=new Date(s);return t.setHours(23,59,59,999),t},j=N.filter(s=>{const t=!u||s.user_name.toLowerCase().includes(u.toLowerCase())||s.products.some(P=>P.product_name.toLowerCase().includes(u.toLowerCase())),r=C==="All"||s.status===C.toLowerCase(),n=s.delivered_date?new Date(s.delivered_date):null,m=(!v||n&&n>=new Date(v))&&(!w||n&&n<=te(w));return t&&r&&m}),I=s=>s?new Date(s).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Not Delivered",U=s=>{b(s),L(""),p(!0)},$=s=>{b(s),y(!0)},R=s=>{b(s),k(!0)},re=async()=>{var s,t;if(!a||!o||Number(o)<=0){g.error("Please enter a valid payment amount.");return}try{await fe.PendingPayment(a.id,o),g.success("Payment successful!"),h(r=>r.map(n=>n.id===a.id?{...n,pending_payment:String(Number(n.pending_payment)-Number(o)),status:Number(n.pending_payment)-Number(o)<=0?"paid":n.status}:n)),p(!1)}catch(r){g.error(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.error)||"Payment failed. Please try again.")}},ne=async()=>{var s,t;if(a)try{await q.cancelOrder(a.id),h(r=>r.map(n=>n.id===a.id?{...n,status:"canceled"}:n)),g.success("Order canceled successfully!"),y(!1)}catch(r){g.error(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to cancel the order.")}},le=s=>_.filter(r=>r.order_id===s.toString()).reduce((r,n)=>r+n.expenses.reduce((m,P)=>m+parseFloat(P.amount||0),0),0).toFixed(2);return K?e.jsx("div",{className:"flex justify-center items-center min-h-screen text-gray-500",children:"Loading..."}):T?e.jsx("div",{className:"flex justify-center items-center min-h-screen text-red-500",children:T}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 bg-gradient-to-br from-gray-50 to-gray-200 dark:from-gray-800 dark:to-gray-900 min-h-screen",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6",children:"Your Orders"}),e.jsx("div",{className:"flex flex-col gap-4 mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsx(f,{placeholder:"Search by User Name or Product...",value:u,onChange:s=>G(s.target.value),className:"w-full sm:w-64 rounded-lg shadow-sm border-gray-300 dark:border-gray-600"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Start Date"}),e.jsx(f,{type:"date",value:v,onChange:s=>W(s.target.value),className:"rounded-lg shadow-sm border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"End Date"}),e.jsx(f,{type:"date",value:w,onChange:s=>Z(s.target.value),className:"rounded-lg shadow-sm border-gray-300 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex flex-col w-full sm:w-40",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{value:C,onChange:s=>ee(s.target.value),className:"w-full border p-2 rounded-lg shadow-sm bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Canceled",children:"Canceled"}),e.jsx("option",{value:"Paid",children:"Paid"})]})]})]})]})}),e.jsx("div",{className:"hidden lg:block bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:e.jsxs(de,{children:[e.jsx(ce,{children:e.jsxs(D,{className:"bg-gray-100 dark:bg-gray-700",children:[e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Order ID"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Client Name"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Delivered Date"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Products"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Quantity"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Address"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Total"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Pending"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Paid"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Status"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-200 text-right",children:"Actions"})]})}),e.jsx(xe,{children:j.length>0?j.map(s=>e.jsxs(D,{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs(i,{className:"text-gray-800 dark:text-gray-200",children:["ARYAN",s.id]}),e.jsx(i,{className:"text-gray-800 dark:text-gray-200",children:s.user_name}),e.jsx(i,{className:"text-gray-600 dark:text-gray-400",children:s.delivered_date}),e.jsxs(i,{className:"text-gray-800 dark:text-gray-200",children:[s.products.length," Products"]}),e.jsx(i,{className:"text-gray-800 dark:text-gray-200",children:s.products.reduce((t,r)=>t+r.quantity,0)}),e.jsx(i,{className:"text-gray-600 dark:text-gray-400",children:s.shipping_address}),e.jsx(i,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{size:14})," ",Number(s.total_amount).toFixed(2)]})}),e.jsx(i,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{size:14})," ",Number(s.pending_payment).toFixed(2)]})}),e.jsx(i,{className:"text-gray-800 dark:text-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{size:14})," ",Number(s.paid_payment).toFixed(2)]})}),e.jsx(i,{children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${s.status==="pending"?"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-200":s.status==="canceled"?"bg-orange-100 text-orange-600 dark:bg-orange-900 dark:text-orange-200":"bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-200"}`,children:[s.status==="pending"?e.jsx(ye,{size:12}):s.status==="canceled"?e.jsx(ue,{size:12}):e.jsx(oe,{size:12}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{size:"sm",className:`px-3 ${s.status==="pending"?"bg-red-600 hover:bg-red-700":s.status==="canceled"?"bg-orange-500":"bg-green-600"} text-white`,onClick:()=>s.status==="pending"&&U(s),disabled:s.status!=="pending",children:s.status==="pending"?"Pay":s.status==="canceled"?"Canceled":"Paid"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>R(s),children:e.jsx(H,{size:16})}),e.jsx(d,{size:"sm",className:"bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>$(s),disabled:s.status==="canceled"||s.status==="paid",children:"Cancel"})]})})]},s.id)):e.jsx(D,{children:e.jsx(i,{colSpan:11,className:"text-center py-6 text-gray-500 dark:text-gray-400",children:"No orders found."})})})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-4",children:j.length>0?j.map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-100",children:["Order #",s.id]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Client:"})," ",s.user_name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Delivered:"})," ",I(s.delivered_date)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Products:"})," ",s.products.length]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Quantity:"})," ",s.products.reduce((t,r)=>t+r.quantity,0)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Total:"})," ₹",Number(s.total_amount).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Pending:"})," ₹",Number(s.pending_payment).toFixed(2)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`font-semibold ${s.status==="pending"?"text-red-600":s.status==="canceled"?"text-orange-600":"text-green-600"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2 flex-wrap",children:[e.jsx(d,{size:"sm",className:`flex-1 ${s.status==="pending"?"bg-red-600 hover:bg-red-700":s.status==="canceled"?"bg-orange-500":"bg-green-600"} text-white`,onClick:()=>s.status==="pending"&&U(s),disabled:s.status!=="pending",children:s.status==="pending"?"Pay":s.status==="canceled"?"Canceled":"Paid"}),e.jsx(d,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>R(s),children:e.jsx(H,{size:16})}),e.jsx(d,{size:"sm",className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>$(s),disabled:s.status==="canceled"||s.status==="paid",children:"Cancel"})]})]},s.id)):e.jsx("div",{className:"col-span-full text-center text-gray-500 dark:text-gray-400 py-6",children:"No orders found."})}),e.jsx(S,{open:Y,onOpenChange:p,children:e.jsxs(z,{className:"sm:max-w-md bg-white dark:bg-gray-800",children:[e.jsxs(F,{children:[e.jsx(O,{className:"text-gray-800 dark:text-gray-100",children:"Confirm Payment"}),e.jsxs(B,{className:"text-gray-600 dark:text-gray-400",children:["Pay the pending amount for Order #",a==null?void 0:a.id,"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Pending Amount"}),e.jsxs("p",{className:"flex items-center gap-1 text-gray-800 dark:text-gray-200",children:[e.jsx(x,{size:15})," ",Number(a==null?void 0:a.pending_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enter Amount"}),e.jsx(f,{type:"number",value:o,onChange:s=>{const t=Number(s.target.value);t>=0&&t<=Number(a==null?void 0:a.pending_payment)?L(s.target.value):g.error("Amount must be between 0 and pending payment.")},className:"mt-1 border-gray-300 dark:border-gray-600",min:"0",max:a==null?void 0:a.pending_payment,step:"0.01"})]})]}),e.jsxs(A,{className:"mt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(d,{onClick:re,className:"bg-blue-600 hover:bg-blue-700",disabled:!o||Number(o)<=0,children:"Confirm Payment"})]})]})}),e.jsx(S,{open:J,onOpenChange:y,children:e.jsxs(z,{className:"sm:max-w-md bg-white dark:bg-gray-800",children:[e.jsxs(F,{children:[e.jsx(O,{className:"text-gray-800 dark:text-gray-100",children:"Confirm Cancellation"}),e.jsxs(B,{className:"text-gray-600 dark:text-gray-400",children:["Are you sure you want to cancel Order #",a==null?void 0:a.id,"? This action cannot be undone."]})]}),e.jsxs(A,{className:"mt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>y(!1),children:"Keep Order"}),e.jsx(d,{onClick:ne,className:"bg-red-600 hover:bg-red-700",children:"Cancel Order"})]})]})}),e.jsx(S,{open:V,onOpenChange:k,children:e.jsxs(z,{className:"max-w-full sm:max-w-4xl bg-white dark:bg-gray-800 p-4 sm:p-6",children:[e.jsx(F,{children:e.jsxs(O,{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100",children:["Order Details - #",a==null?void 0:a.id]})}),a&&e.jsxs("div",{className:"space-y-4 text-gray-700 dark:text-gray-300 text-sm sm:text-base",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",I(a.created_at)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",a.user_phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Delivered:"})," ",a.delivered_date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pickup:"})," ",a.pickup_time]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Client Address:"})," ",a.user_address,", ",a.user_city,", ",a.user_zip]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Shipping Address:"})," ",a.shipping_address,", ",a.user_city,", ",a.user_zip]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Amount:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{size:15})," ",Number(a.total_amount).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pending:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{size:15})," ",Number(a.pending_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paid:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{size:15})," ",Number(a.paid_payment).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`font-semibold ${a.status==="pending"?"text-red-600":a.status==="canceled"?"text-orange-600":"text-green-600"}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Products:"}),e.jsx("ul",{className:"list-disc pl-5 mt-2 space-y-2",children:a.products.map((s,t)=>e.jsxs("li",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[s.product_name," - ",s.quantity," KG x ",e.jsx(x,{size:14})," ",Number(s.product_price).toFixed(2)," ="," ",e.jsx(x,{size:14})," ",Number(s.total_price).toFixed(2)]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs sm:text-sm",children:["(From: ",s.From,")"]})]},t))})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expenses:"}),_.filter(s=>s.order_id===a.id.toString()).length>0?e.jsxs("div",{className:"mt-2 space-y-3",children:[_.filter(s=>s.order_id===a.id.toString()).map((s,t)=>e.jsxs("div",{className:"border-t pt-2",children:[e.jsxs("p",{className:"font-medium",children:[e.jsx("strong",{children:"Date:"})," ",me(ge(s.expense_date),"yyyy-MM-dd")]}),e.jsx("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:s.expenses.map((r,n)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[r.type,":"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(x,{size:14})," ",Number(r.amount).toFixed(2)]})]},n))})]},t)),e.jsxs("p",{className:"mt-2 font-medium",children:[e.jsx("strong",{children:"Total Expenses:"})," ",e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{size:15})," ",le(a.id)]})]})]}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No expenses recorded for this order."})]})]}),e.jsx(A,{className:"mt-6",children:e.jsx(d,{onClick:()=>k(!1),className:"bg-gray-600 hover:bg-gray-700 w-full sm:w-auto",children:"Close"})})]})})]})}function Ee(){return e.jsx(ie,{children:e.jsx(Ne,{})})}export{Ee as default};
